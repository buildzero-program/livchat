{
	"meta": {
		"generatedAt": "2025-12-07T15:44:56.921Z",
		"tasksAnalyzed": 11,
		"totalTasks": 11,
		"analysisCount": 11,
		"thresholdScore": 5,
		"projectName": "Task Master",
		"usedResearch": false
	},
	"complexityAnalysis": [
		{
			"taskId": 12,
			"taskTitle": "Rename demo router to whatsapp router",
			"complexityScore": 2,
			"recommendedSubtasks": 0,
			"expansionPrompt": "Simple file rename and find-replace task. Rename demo.ts to whatsapp.ts, update exports from demoRouter to whatsappRouter, and update root.ts import.",
			"reasoning": "Straightforward rename task. Files involved: demo.ts (502 lines), root.ts (24 lines). Changes are mechanical: (1) rename file, (2) change export name demoRouter→whatsappRouter, (3) update root.ts import and registration. No logic changes, no new code. Type checker will catch any missed references. Estimated ~5 minutes."
		},
		{
			"taskId": 13,
			"taskTitle": "Rename useDemo hook to useWhatsApp hook",
			"complexityScore": 2,
			"recommendedSubtasks": 0,
			"expansionPrompt": "Rename useDemo.ts to useWhatsApp.ts, update function/type names, change all api.demo.* to api.whatsapp.*, and update consumer in hero.tsx.",
			"reasoning": "Mechanical rename task. Files: useDemo.ts (243 lines), hero.tsx (136 lines - single consumer). Changes: (1) rename file, (2) rename function useDemo→useWhatsApp, (3) rename type UseDemoReturn→UseWhatsAppReturn, (4) update 5 tRPC calls from api.demo.* to api.whatsapp.*, (5) update import in hero.tsx. Depends on task 12 completing first. TypeScript will validate correctness."
		},
		{
			"taskId": 14,
			"taskTitle": "Rename demo.test.ts to whatsapp.test.ts",
			"complexityScore": 2,
			"recommendedSubtasks": 0,
			"expansionPrompt": "Rename test file, update import to whatsappRouter, update describe blocks and caller factory reference.",
			"reasoning": "Simple test file rename. File: demo.test.ts (420 lines). Changes: (1) rename file, (2) update import from demo to whatsapp router, (3) update 6 describe block strings, (4) update createCallerFactory call. All mechanical replacements, no test logic changes. Running bun test will verify correctness."
		},
		{
			"taskId": 15,
			"taskTitle": "Add whatsapp.list procedure for dashboard",
			"complexityScore": 5,
			"recommendedSubtasks": 4,
			"expansionPrompt": "Implement the list procedure: (1) Create protectedProcedure that fetches organization instances using existing getOrganizationInstances helper, (2) For each instance, call WuzAPIClient.getStatus() to get real-time connection status, (3) Fetch organization limits from database, (4) Return formatted response with instances array including id, phoneNumber, deviceName, pictureUrl, connected, loggedIn, connectedSince, messagesUsed, plus total/maxInstances/messagesLimit. Handle WuzAPI errors gracefully by returning offline status. Write unit tests for empty state, populated state, and error handling.",
			"reasoning": "Medium complexity. Requires: (1) Using protectedProcedure (already exists in trpc.ts), (2) Calling getOrganizationInstances (exists in instance.ts), (3) Iterating instances with Promise.all to fetch WuzAPI status, (4) Error handling for WuzAPI failures, (5) Querying organization for limits. Infrastructure exists but needs orchestration. Need extractPhoneFromJID helper (exists in demo.ts, need to extract or duplicate). Testing requires mocking both DB and WuzAPI responses."
		},
		{
			"taskId": 16,
			"taskTitle": "Add connectedSince, deviceName, and pictureUrl to whatsapp.status",
			"complexityScore": 2,
			"recommendedSubtasks": 0,
			"expansionPrompt": "Add three new fields to the status procedure response: connectedSince from instance.lastConnectedAt, deviceName from instance.whatsappName with fallback, pictureUrl from instance.whatsappPictureUrl. Update useWhatsApp hook to expose these fields.",
			"reasoning": "Low complexity. The status procedure already fetches the instance object and has access to all required fields (lastConnectedAt, whatsappName, whatsappPictureUrl exist in schema). Just need to add 3 lines to the response object and 3 fields to the hook's return type. Error fallback already exists, just add nulls for new fields."
		},
		{
			"taskId": 17,
			"taskTitle": "Install @vercel/blob and create blob-storage helper",
			"complexityScore": 3,
			"recommendedSubtasks": 0,
			"expansionPrompt": "Install @vercel/blob package, create src/server/lib/blob-storage.ts with uploadProfilePicture (fetch from URL, upload to Vercel Blob) and deleteProfilePicture functions. Handle errors gracefully.",
			"reasoning": "Low-medium complexity. New dependency installation (simple). New file creation with two functions. uploadProfilePicture: fetch image from URL → convert to blob → upload via @vercel/blob put(). deleteProfilePicture: call del() with error handling. Requires BLOB_READ_WRITE_TOKEN env var. Clean greenfield code, no existing code to integrate with. Testing requires mocking @vercel/blob and fetch."
		},
		{
			"taskId": 18,
			"taskTitle": "Add getAvatar method to WuzAPIClient",
			"complexityScore": 2,
			"recommendedSubtasks": 0,
			"expansionPrompt": "Add WuzAPIAvatarData interface and getAvatar method to WuzAPIClient class in wuzapi.ts. Method should extract phone from JID and call /user/avatar endpoint.",
			"reasoning": "Simple addition to existing WuzAPIClient class. Pattern already established with 7 existing methods (getStatus, getQR, getPairingCode, sendText, checkNumbers, logout, connect). Just add interface + method following same pattern. ~15 lines of code. Phone extraction from JID pattern exists in demo.ts."
		},
		{
			"taskId": 19,
			"taskTitle": "Add whatsapp.updateAvatar procedure",
			"complexityScore": 4,
			"recommendedSubtasks": 0,
			"expansionPrompt": "Create protectedProcedure mutation that: validates instanceId input, gets instance with access check using getInstanceWithAccess, calls client.getAvatar to fetch WhatsApp avatar URL, uploads to Vercel Blob via uploadProfilePicture, saves URL to database. Handle cases: instance not found, not connected, no avatar, upload failure.",
			"reasoning": "Medium complexity. Orchestrates multiple components: (1) protectedProcedure with input validation, (2) getInstanceWithAccess for auth, (3) WuzAPIClient.getAvatar, (4) uploadProfilePicture from blob-storage, (5) database update. Multiple error cases to handle. Dependencies: tasks 15, 17, 18. All building blocks will exist, just need to wire them together with proper error handling."
		},
		{
			"taskId": 20,
			"taskTitle": "Create InstancesWidget component with carousel",
			"complexityScore": 6,
			"recommendedSubtasks": 5,
			"expansionPrompt": "Create InstancesWidget: (1) Build main component with useState for currentIndex, useQuery for api.whatsapp.list with 30s refetchInterval, (2) Implement carousel navigation with ChevronLeft/Right buttons and index display, (3) Create instance card UI with Avatar, phone number, device name, status badge with animation, uptime display, and action buttons (Reconnect, Disconnect), (4) Create InstancesWidgetSkeleton loading state with animated placeholders, (5) Create InstancesWidgetEmpty state for no instances, (6) Create InstancesWidgetError state. Wire disconnect mutation to api.whatsapp.disconnect. Use existing UI components from ~/components/ui/*.",
			"reasoning": "Higher complexity frontend component. Requires: (1) State management for carousel, (2) tRPC query integration with polling, (3) Multiple UI states (loading/empty/error/data), (4) Carousel navigation logic with wrap-around, (5) Real-time status display with animated badge, (6) Action buttons with mutation handling. Existing patterns in ConnectionWidget (133 lines) provide good reference. UI primitives (Card, Badge, Avatar, Button, Skeleton) all exist. framer-motion already in use."
		},
		{
			"taskId": 21,
			"taskTitle": "Update dashboard page to use InstancesWidget",
			"complexityScore": 1,
			"recommendedSubtasks": 0,
			"expansionPrompt": "Update dashboard/index.ts exports to add InstancesWidget. Update app/(app)/app/page.tsx to import and use InstancesWidget instead of ConnectionWidget.",
			"reasoning": "Trivial update. dashboard/index.ts: add one export line. page.tsx: change one import and one component reference. Total ~4 lines changed across 2 files. ConnectionWidget can remain for potential LP usage."
		},
		{
			"taskId": 22,
			"taskTitle": "End-to-end testing and final verification",
			"complexityScore": 4,
			"recommendedSubtasks": 3,
			"expansionPrompt": "Create E2E verification checklist: (1) Test LP flow - QR display, WhatsApp connection, message sending, counter update, disconnect, (2) Test signup conversion - after LP connection, complete Clerk auth, verify instance claim, verify dashboard redirect, (3) Test dashboard InstancesWidget - verify widget shows instances, test carousel if multiple, verify data accuracy (phone, name, status, avatar), test disconnect, verify polling updates, (4) Code verification - grep for remaining 'demo' references excluding comments, run bun test, bun build, bun typecheck. Document any issues found.",
			"reasoning": "Medium complexity testing task. Primarily manual testing across multiple user flows. No new code to write, but requires systematic verification. LP flow tests existing functionality with renamed components. Dashboard tests new InstancesWidget with real data. Code verification ensures complete rename. Can be parallelized: one person does UI testing while another does code verification."
		}
	]
}